<div class="container">
  <h1>Profile manager</h1>
  <!-- CLIENT INFO SECTION -->
  <form #form="ngForm" (ngSubmit)="onEnter(form)" class="mb-3">
    <div class="w-75">
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="first_name">First name</label>
          <input
            id="first_name"
            name="first_name"
            class="form-control"
            type="text"
            placeholder="First name"
            [(ngModel)]="user.first_name"
            required
            #firstNameField="ngModel"
            [class.field-error]="form.submitted && firstNameField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && firstNameField.invalid"
          >
            Input not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="last_name">Last name</label>
          <input
            id="last_name"
            name="last_name"
            class="form-control"
            type="text"
            placeholder="Last name"
            [(ngModel)]="user.last_name"
            required
            #lastNameField="ngModel"
            [class.field-error]="form.submitted && lastNameField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && lastNameField.invalid"
          >
            Input not valid
          </small>
        </div>
      </div>
      <div class="row w-100">
        <div class="form-group col-12 p-2">
          <label for="email">Email</label>
          <input
            id="email"
            name="email"
            class="form-control"
            type="email"
            placeholder="example@mail.com"
            [(ngModel)]="user.email"
            required
            pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$"
            #emailField="ngModel"
            [class.field-error]="form.submitted && emailField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && emailField.invalid"
          >
            Email not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="telephone">Telephone</label>
          <input
            id="telephone"
            name="telephone"
            class="form-control"
            type="text"
            placeholder="000 0000000"
            [(ngModel)]="user.telephone"
            required
            #telephoneField="ngModel"
            [class.field-error]="form.submitted && telephoneField.invalid"
          />
          <small class="text-danger" *ngIf="form.submitted">
            Telephone not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="telephone">Date of Birth</label>
          <input
            id="birthDate"
            name="birthDate"
            class="form-control"
            type="date"
            [(ngModel)]="user.birth_date"
            required
            #birthDateField="ngModel"
            [class.field-error]="form.submitted && birthDateField.invalid"
          />
          <small class="text-danger" *ngIf="form.submitted">
            Date not valid
          </small>
        </div>
      </div>
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="password">Password</label>
          <input
            id="password"
            name="password"
            class="form-control"
            type="password"
            placeholder="••••••••"
            [(ngModel)]="user.password"
            required
            #passwordField="ngModel"
            [class.field-error]="form.submitted && passwordField.invalid"
            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && passwordField.invalid"
          >
            Must contain at least one number and one uppercase and lowercase
            letter, and at least 8 or more characters
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="confirmPassword">Confirm Password</label>
          <input
            id="confirmPassword"
            name="confirmPassword"
            class="form-control"
            type="password"
            placeholder="••••••••"
            [(ngModel)]="confirmPassword"
            required
            #confirmPasswordField="ngModel"
            [class.field-error]="
              (form.submitted && confirmPasswordField.invalid) ||
              confirmPasswordField.value != passwordField.value
            "
            pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
          />
          <small
            class="text-danger"
            *ngIf="
              (form.submitted && confirmPasswordField.invalid) ||
              confirmPasswordField.value != passwordField.value
            "
          >
            Not the same password
          </small>
        </div>
      </div>

      <div class="row w-100 px-2">
        <button type="submit" class="btn btn-primary">Update info</button>
      </div>
    </div>
  </form>

  <!-- ALL ADDRESSES SECTION -->
  <div class="w-75">
    <div class="col-12"><h3>Your Addresses</h3></div>
    <div class="col-12 pb-2 border-bottom border-secondary" *ngFor="let address of allAddresses">
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="street">Street</label>
          <input
            id="street"
            name="street"
            class="form-control"
            type="text"
            placeholder="Street"
            [(ngModel)]="address.street"
            required
            #streetField="ngModel"
            [class.field-error]="form.submitted && streetField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && streetField.invalid"
          >
            Street not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="city">City</label>
          <input
            id="city"
            name="city"
            class="form-control"
            type="text"
            placeholder="City"
            [(ngModel)]="address.city"
            required
            #cityField="ngModel"
            [class.field-error]="form.submitted && cityField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && cityField.invalid"
          >
            City not valid
          </small>
        </div>
      </div>
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="zip_code">ZIP Code</label>
          <input
            id="zip_code"
            name="zip_code"
            class="form-control"
            type="text"
            placeholder="00000"
            [(ngModel)]="address.zip_code"
            required
            #zipCodeField="ngModel"
            [class.field-error]="form.submitted && zipCodeField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && zipCodeField.invalid"
          >
            ZIP Code not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="nation">Nation</label>
          <input
            id="nation"
            name="nation"
            class="form-control"
            type="text"
            placeholder="Nation"
            [(ngModel)]="address.nation"
            required
            #nationField="ngModel"
            [class.field-error]="form.submitted && nationField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && nationField.invalid"
          >
            Nation not valid
          </small>
        </div>
      </div>

      <div class="row justify-content-around">
        <button class="btn btn-danger m-2 col-5" (click)="deleteAddress(address.id_address)">Delete</button>
        <button *ngIf="!address.main" class="btn btn-warning m-2 col-5" (click)="setAsMainAddress(address.id_address)">
          Set as main address
        </button>
      </div>
    </div>

    <!-- NEW ADDRESS SECTION -->
    <button class="btn btn-success mt-3" (click)="toggleShowNewAddress()">New address</button>
    <div class="col-12" *ngIf="showNewAddress">
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="street">Street</label>
          <input
            id="street"
            name="street"
            class="form-control"
            type="text"
            placeholder="Street"
            [(ngModel)]="newAddress.street"
            required
            #streetField="ngModel"
            [class.field-error]="form.submitted && streetField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && streetField.invalid"
          >
            Street not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="city">City</label>
          <input
            id="city"
            name="city"
            class="form-control"
            type="text"
            placeholder="City"
            [(ngModel)]="newAddress.city"
            required
            #cityField="ngModel"
            [class.field-error]="form.submitted && cityField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && cityField.invalid"
          >
            City not valid
          </small>
        </div>
      </div>
      <div class="row w-100">
        <div class="form-group col p-2">
          <label for="zip_code">ZIP Code</label>
          <input
            id="zip_code"
            name="zip_code"
            class="form-control"
            type="text"
            placeholder="00000"
            [(ngModel)]="newAddress.zip_code"
            required
            #zipCodeField="ngModel"
            [class.field-error]="form.submitted && zipCodeField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && zipCodeField.invalid"
          >
            ZIP Code not valid
          </small>
        </div>
        <div class="form-group col p-2">
          <label for="nation">Nation</label>
          <input
            id="nation"
            name="nation"
            class="form-control"
            type="text"
            placeholder="Nation"
            [(ngModel)]="newAddress.nation"
            required
            #nationField="ngModel"
            [class.field-error]="form.submitted && nationField.invalid"
          />
          <small
            class="text-danger"
            *ngIf="form.submitted && nationField.invalid"
          >
            Nation not valid
          </small>
        </div>
        <button class="btn btn-primary" (click)="saveNewAddress()">Save</button>
      </div>
    </div>
  </div>
</div>
